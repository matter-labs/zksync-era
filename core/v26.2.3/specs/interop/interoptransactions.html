<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Interop Transactions - ZKsync Era Documentation</title>


        <!-- Custom HTML head -->
        <script src="https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js"></script>

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../css/version-box.css">

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">ZKsync Era Documentation</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/matter-labs/zksync-era/tree/main/docs" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/matter-labs/zksync-era/tree/main/docs/src/specs/interop/interoptransactions.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="interop-transactions"><a class="header" href="#interop-transactions">Interop Transactions</a></h1>
<h2 id="basics"><a class="header" href="#basics">Basics</a></h2>
<p>The <strong>InteropTransaction</strong> sits at the top of our interop stack, acting as the “delivery” mechanism for <strong>Interop
Bundles</strong>.</p>
<p>Think of it like a car that picks up our “hitchhiker” bundles and carries them to their destination.</p>
<p><img src="../img/interoptx.png" alt="interoptx.png" /></p>
<p><strong>Note:</strong> Interop Transactions aren’t the only way to execute a bundle. Once an interop bundle is created on the source
chain, users can simply send a regular transaction on the destination chain to execute it.</p>
<p>However, this approach can be inconvenient as it requires users to have funds on the destination chain to cover gas fees
and to configure the necessary network settings (like the RPC address).</p>
<p><strong>InteropTransactions</strong> simplify this process by handling everything from the source chain. They allow you to select
which <strong>interopBundle</strong> to execute, specify gas details (such as gas amount and gas price), and determine who will cover
the gas costs. This can be achieved using tokens on the source chain or through a paymaster.</p>
<p>Once configured, the transaction will automatically execute, either by the chain operator, the gateway, or off-chain
tools.</p>
<p>An <strong>InteropTransaction</strong> contains two pointers to bundles:</p>
<ul>
<li><strong>feesBundle</strong>: Holds interop calls to cover fees.</li>
<li><strong>bundleHash</strong>: Contains the main execution.</li>
</ul>
<p><img src="../img/ipointers.png" alt="ipointers.png" /></p>
<h2 id="interface"><a class="header" href="#interface">Interface</a></h2>
<p>The function <code>sendInteropTransaction</code> provides all the options. For simpler use cases, refer to the helper methods
defined later in the article.</p>
<pre><code class="language-solidity">contract InteropCenter {
  /// Creates a transaction that will attempt to execute a given Bundle on the destination chain.
  /// Such transaction can be 'picked up' by the destination chain automatically.
  /// This function covers all the cases - we expect most users to use the helper
  /// functions defined later.
 function sendInteropTransaction(
  destinationChain,
  bundleHash,        // the main bundle that you want to execute on destination chain
  gasLimit,          // gasLimit &amp; price for execution
  gasPrice,
  feesBundleHash,  // this is the bundle that contains the calls to pay for gas
  destinationPaymaster,  // optionally - you can use a paymaster on destination chain
  destinationPaymasterInput); // with specific params


 struct InteropTransaction {
  address sourceChainSender
  uint256 destinationChain
   uint256 gasLimit;
   uint256 gasPrice;
   uint256 value;
   bytes32 bundleHash;
   bytes32 feesBundleHash;
    address destinationPaymaster;
   bytes destinationPaymasterInput;
 }
}
</code></pre>
<p>After creating the <strong>InteropBundle</strong>, you can simply call <code>sendInteropTransaction</code> to create the complete transaction
that will execute the bundle.</p>
<h2 id="retries"><a class="header" href="#retries">Retries</a></h2>
<p>If your transaction fails to execute the bundle (e.g., due to a low gas limit) or isn’t included at all (e.g., due to
too low gasPrice), you can send another transaction to <strong>attempt to execute the same bundle again</strong>.</p>
<p>Simply call <code>sendInteropTransaction</code> again with updated gas settings.</p>
<h3 id="example-of-retrying"><a class="header" href="#example-of-retrying">Example of Retrying</a></h3>
<p>Here’s a concrete example: Suppose you created a bundle to perform a swap that includes transferring 100 ETH, executing
the swap, and transferring some tokens back.</p>
<p>You attempted to send the interop transaction with a low gas limit (e.g., 100). Since you didn’t have any base tokens on
the destination chain, you created a separate bundle to transfer a small fee (e.g., 0.0001) to cover the gas.</p>
<p>You sent your first interop transaction to the destination chain, but it failed due to insufficient gas. However, your
“fee bundle” was successfully executed, as it covered the gas cost for the failed attempt.</p>
<p>Now, you have two options: either cancel the execution bundle (the one with 100 ETH) or retry.</p>
<p>To retry, you decide to set a higher gas limit (e.g., 10,000) and create another fee transfer (e.g., 0.01) but use <strong>the
same execution bundle</strong> as before.</p>
<p>This time, the transaction succeeds — the swap completes on the destination chain, and the resulting tokens are
successfully transferred back to the source chain.</p>
<p><img src="../img/retryexample.png" alt="retryexample.png" /></p>
<h2 id="fees--restrictions"><a class="header" href="#fees--restrictions">Fees &amp; Restrictions</a></h2>
<p>Using an <strong>InteropBundle</strong> for fee payments offers flexibility, allowing users to transfer a small amount to cover the
fees while keeping the main assets in the execution bundle itself.</p>
<h3 id="restrictions"><a class="header" href="#restrictions">Restrictions</a></h3>
<p>This flexibility comes with trade-offs, similar to the validation phases in <strong>Account Abstraction</strong> or <strong>ERC4337</strong>,
primarily designed to prevent DoS attacks. Key restrictions include:</p>
<ul>
<li><strong>Lower gas limits</strong></li>
<li><strong>Limited access to specific slots</strong></li>
</ul>
<p>Additionally, when the <code>INTEROP_CENTER</code> constructs an <strong>InteropTransaction</strong>, it enforces extra restrictions on
<strong>feePaymentBundles</strong>:</p>
<ul>
<li><strong>Restricted Executors</strong>:<br />
Only your <strong>AliasedAccount</strong> on the receiving side can execute the <code>feePaymentBundle</code>.</li>
</ul>
<p>This restriction is crucial for security, preventing others from executing your <strong>fee bundle</strong>, which could cause your
transaction to fail and prevent the <strong>execution bundle</strong> from processing.</p>
<h3 id="types-of-fees"><a class="header" href="#types-of-fees"><strong>Types of Fees</strong></a></h3>
<h4 id="using-the-destination-chains-base-token"><a class="header" href="#using-the-destination-chains-base-token">Using the Destination Chain’s Base Token</a></h4>
<p>The simplest scenario is when you (as the sender) already have the destination chain’s base token available on the
source chain.</p>
<p>For example:</p>
<ul>
<li>If you are sending a transaction from <strong>Era</strong> (base token: ETH) to <strong>Sophon</strong> (base token: SOPH) and already have SOPH
on ERA, you can use it for the fee.</li>
</ul>
<p>To make this easier, we’ll provide a helper function:</p>
<pre><code class="language-solidity">contract InteropCenter {
  // Creates InteropTransaction to the destination chain with payment with base token.
  // Before calling, you have to 'approve' InteropCenter to the ERC20/Bridge that holds the destination chain's base tokens.
  // or if the destination chain's tokens are the same as yours, just attach value to this call.
  function sendInteropTxMinimal(
   destinationChain,
   bundleHash,        // the main bundle that you want to execute on destination chain
   gasLimit,          // gasLimit &amp; price for execution
   gasPrice,
  );
 }
</code></pre>
<h4 id="using-paymaster-on-the-destination-chain"><a class="header" href="#using-paymaster-on-the-destination-chain">Using paymaster on the destination chain</a></h4>
<p>If you don’t have the base token from the destination chain (e.g., SOPH in our example) on your source chain, you’ll
need to use a paymaster on the destination chain instead.</p>
<p>In this case, you’ll send the token you do have (e.g., USDC) to the destination chain as part of the <strong>feeBundleHash</strong>.
Once there, you’ll use it to pay the paymaster on the destination chain to cover your gas fees.</p>
<p>Your <strong>InteropTransaction</strong> would look like this:</p>
<p><img src="../img/paymastertx.png" alt="paymastertx.png" /></p>
<h2 id="automatic-execution"><a class="header" href="#automatic-execution"><strong>Automatic Execution</strong></a></h2>
<p>One of the main advantages of <strong>InteropTransactions</strong> is that they execute automatically. As the sender on the source
chain, you don’t need to worry about technical details like RPC addresses or obtaining proofs — it’s all handled for
you.</p>
<p>After creating an <strong>InteropTransaction</strong>, it can be relayed to the destination chain by anyone. The transaction already
includes a signature (also known as an interop message proof), making it fully self-contained and ready to send without
requiring additional permissions.</p>
<p>Typically, the destination chain’s operator will handle and include incoming <strong>InteropTransactions</strong>. However, if they
don’t, the <strong>Gateway</strong> or other participants can step in to prepare and send them.</p>
<p>You can also use the available tools to create and send the destination transaction yourself. Since the transaction is
self-contained, it doesn’t require additional funds or signatures to execute.</p>
<p><img src="../img/autoexecution.png" alt="Usually destination chain operator will keep querying gateway to see if there are any messages for their chain." /></p>
<p>Once they see the message, they can request the proof from the <strong>Gateway</strong> and also fetch the <strong>InteropBundles</strong>
contained within the message (along with their respective proofs).</p>
<p><img src="../img/chainop.png" alt="Operator getting necessary data from Gateway." /></p>
<p>As the final step, the operator can use the received data to create a regular transaction, which can then be sent to
their chain.</p>
<p><img src="../img/finaltx.png" alt="Creating the final transaction to send to the destination chain" /></p>
<p>The steps above don’t require any special permissions and can be executed by anyone.</p>
<p>While the <strong>Gateway</strong> was used above for tasks like providing proofs, if the Gateway becomes malicious, all this
information can still be constructed off-chain using data available on L1.</p>
<h3 id="how-it-works-under-the-hood"><a class="header" href="#how-it-works-under-the-hood">How it Works Under the hood</a></h3>
<p>We’ll modify the default account to accept interop proofs as signatures, seamlessly integrating with the existing ZKSync
native <strong>Account Abstraction</strong> model.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../specs/interop/bundlesandcalls.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../announcements/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../specs/interop/bundlesandcalls.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../announcements/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>



        <script>
            window.playground_line_numbers = true;
        </script>

        <script>
            window.playground_copyable = true;
        </script>

        <script src="../../ace.js"></script>
        <script src="../../editor.js"></script>
        <script src="../../mode-rust.js"></script>
        <script src="../../theme-dawn.js"></script>
        <script src="../../theme-tomorrow_night.js"></script>

        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../js/version-box.js"></script>
        <script src="../../js/mermaid-init.js"></script>


    </div>
    </body>
</html>
