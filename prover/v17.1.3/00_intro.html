<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Introduction - ZKsync Prover Documentation</title>


        <!-- Custom HTML head -->
        <script src="https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js"></script>

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="css/version-box.css">

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">ZKsync Prover Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/matter-labs/zksync-era/tree/main/prover/docs" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/matter-labs/zksync-era/tree/main/prover/docs/src/00_intro.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="prover-subsystem-introduction"><a class="header" href="#prover-subsystem-introduction">Prover subsystem introduction</a></h1>
<p>The prover subsystem consists of several binaries that perform different steps of the batch proof generation process, as
follows:</p>
<ul>
<li><a href="https://github.com/matter-labs/zksync-era/tree/main/prover/crates/bin/prover_fri_gateway">Prover gateway</a>: interface between core and prover subsystems, fetches batch jobs from core, and sends batch
proofs back to core.</li>
<li><a href="https://github.com/matter-labs/zksync-era/tree/main/prover/crates/bin/witness_generator">Witness generator</a>: component that takes batch information (tx execution/state diffs/computation results) and
constructs witness for proof generation.</li>
<li><a href="https://github.com/matter-labs/zksync-era/tree/main/prover/crates/bin/witness_vector_generator">Witness vector generator</a>: component that uses witness generator output and computes witness vector (<em>roughly</em>:
data to be fed into GPU) for circuit provers.</li>
<li><a href="https://github.com/matter-labs/zksync-era/tree/main/prover/crates/bin/prover_fri">Circuit prover</a>: component that generates a circuit proof (GPU accelerated).</li>
<li><a href="https://github.com/matter-labs/zksync-era/tree/main/prover/crates/bin/proof_fri_compressor">Proof compressor</a>: component that “wraps” the generated proof so that it can be sent to L1 (GPU accelerated).</li>
</ul>
<p>While not technically a part of the prover workspace, the following components are essential for it:</p>
<ul>
<li><a href="https://github.com/matter-labs/zksync-era/tree/main/core/node/proof_data_handler">Proof data handler</a>: API on the core side which Prover gateway interacts with.</li>
<li><a href="https://github.com/matter-labs/zksync-era/tree/main/core/node/house_keeper">House keeper</a>: Metrics exporter and job rescheduler. In it’s absence, jobs would not be rescheduled and metrics
used for autoscaling would not exist, rendering internal autoscaling infrastructure useless.</li>
</ul>
<p>Finally, the prover workspace has several CLI tools:</p>
<ul>
<li><a href="https://github.com/matter-labs/zksync-era/tree/main/prover/crates/bin/vk_setup_data_generator_server_fri">Circuit key generator</a>: CLI used to generate keys required for proving.</li>
<li><a href="https://github.com/matter-labs/zksync-era/tree/main/prover/crates/bin/prover_cli">Prover CLI</a>: CLI for observing and maintaining the production proving infrastructure.</li>
</ul>
<p>There are core components that also participate in the proof generation process by preparing the input data, such as
<a href="https://github.com/matter-labs/zksync-era/tree/main/core/node/metadata_calculator">metadata calculator</a>, <a href="https://github.com/matter-labs/zksync-era/tree/main/core/node/commitment_generator">commitment generator</a>, <a href="https://github.com/matter-labs/zksync-era/blob/main/core/node/vm_runner/src/impls/bwip.rs">basic witness input producer</a>, and <a href="https://github.com/matter-labs/zksync-era/blob/main/core/node/vm_runner/src/impls/protective_reads.rs">protective reads
writer</a>. We won’t cover them much in these docs, but it’s better to know that they exist and are important for the
prover subsystem as well.</p>
<p>We’ll cover how the components work further in documentation.</p>
<h2 id="how-it-runs"><a class="header" href="#how-it-runs">How it runs</a></h2>
<p>Proof generation is a multi-stage process, where the initial jobs are created by the Prover gateway, and then moved by
the House Keeper until the proof is generated.</p>
<p>The real-life deployment of prover subsystem looks as follows:</p>
<ul>
<li>1x prover gateway</li>
<li>1x house keeper</li>
<li>Many witness generators</li>
<li>Many witness vector generators</li>
<li>Many circuit provers</li>
<li>1+ proof compressors</li>
</ul>
<p>Currently, the proving subsystem is designed to run in GCP. In theory, it’s mostly environment-agnostic, and all of the
components can be launched locally, but more work is needed to run a production system in a distributed mode outside of
GCP.</p>
<p>Witness generators, witness vector generators, and provers are spawned on demand based on the current system load via an
autoscaler (WIP, so not released publicly yet). They can be spawned in multiple clusters among different zones, based on
the availability of machines with required specs.</p>
<h2 id="how-to-develop"><a class="header" href="#how-to-develop">How to develop</a></h2>
<p>Different parts of the subsystem have different hardware requirement, but the aggregated summary to be able to run
everything on a single machine is as follows:</p>
<ul>
<li>CPU with 16+ physical cores.</li>
<li>GPU with CUDA support and at least 24 GB of VRAM.</li>
<li>At least 64GB of RAM.</li>
<li>200+ GB of disk space. 400+ GB is recommended for development, as <code>/target</code> directory can get quite large.</li>
</ul>
<p>Given that the requirements are quite high, it’s often more convenient developing the prover in a GCP VM rather than on
a local machine. Setting up a VM is covered further in docs.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->

                            <a rel="next prefetch" href="01_gcp_vm.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

                    <a rel="next prefetch" href="01_gcp_vm.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>



        <script>
            window.playground_line_numbers = true;
        </script>

        <script>
            window.playground_copyable = true;
        </script>

        <script src="ace.js"></script>
        <script src="editor.js"></script>
        <script src="mode-rust.js"></script>
        <script src="theme-dawn.js"></script>
        <script src="theme-tomorrow_night.js"></script>

        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="js/version-box.js"></script>
        <script src="js/mermaid-init.js"></script>


    </div>
    </body>
</html>
