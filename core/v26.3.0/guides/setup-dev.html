<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Setup Dev - ZKsync Era Documentation</title>


        <!-- Custom HTML head -->
        <script src="https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js"></script>

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../css/version-box.css">

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">ZKsync Era Documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/matter-labs/zksync-era/tree/main/docs" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/matter-labs/zksync-era/tree/main/docs/src/guides/setup-dev.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="installing-dependencies"><a class="header" href="#installing-dependencies">Installing dependencies</a></h1>
<h2 id="tldr"><a class="header" href="#tldr">TL;DR</a></h2>
<p>This is a shorter version of setup guide to make it easier subsequent initializations. If it’s the first time you’re
initializing the workspace, it’s recommended that you read the whole guide below, as it provides more context and tips.</p>
<p>If you run on ‘clean’ Ubuntu on GCP:</p>
<pre><code class="language-bash"># For VMs only! They don't have SSH keys, so we override SSH with HTTPS
git config --global url."https://github.com/".insteadOf git@github.com:
git config --global url."https://".insteadOf git://

# Rust
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh

# NVM
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.5/install.sh | bash

# All necessary stuff
sudo apt-get update
sudo apt-get install -y build-essential pkg-config cmake clang lldb lld libssl-dev libpq-dev apt-transport-https ca-certificates curl software-properties-common

# Install docker
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu focal stable"
sudo apt install docker-ce
sudo usermod -aG docker ${USER}

# Start docker.
sudo systemctl start docker

## You might need to re-connect (due to usermod change).

# Node &amp; yarn
nvm install 20
# Important: there will be a note in the output to load
# new paths in your local session, either run it or reload the terminal.
npm install -g yarn
yarn set version 1.22.19

# For running unit tests
cargo install cargo-nextest
# SQL tools
cargo install sqlx-cli --version 0.8.1

# Foundry ZKsync
curl -L https://raw.githubusercontent.com/matter-labs/foundry-zksync/main/install-foundry-zksync | bash
foundryup-zksync

# Non CUDA (GPU) setup, can be skipped if the machine has a CUDA installed for provers
# Don't do that if you intend to run provers on your machine. Check the prover docs for a setup instead.
echo "export ZKSYNC_USE_CUDA_STUBS=true" &gt;&gt; ~/.bashrc
# You will need to reload your `*rc` file here

# Clone the repo to the desired location
git clone git@github.com:matter-labs/zksync-era.git
cd zksync-era
git submodule update --init --recursive
</code></pre>
<p>Don’t forget to look at <a href="#tips">tips</a>.</p>
<h2 id="supported-operating-systems"><a class="header" href="#supported-operating-systems">Supported operating systems</a></h2>
<p>ZKsync currently can be launched on any *nix operating system (e.g. any linux distribution or macOS).</p>
<p>If you’re using Windows, then make sure to use WSL 2.</p>
<p>Additionally, if you are going to use WSL 2, make sure that your project is located in the <em>linux filesystem</em>, since
accessing NTFS partitions from within WSL is very slow.</p>
<p>If you’re using macOS with an ARM processor (e.g. M1/M2), make sure that you are working in the <em>native</em> environment
(e.g., your terminal and IDE don’t run in Rosetta, and your toolchain is native). Trying to work with ZKsync code via
Rosetta may cause problems that are hard to spot and debug, so make sure to check everything before you start.</p>
<p>If you are a NixOS user or would like to have a reproducible environment, skip to the section about <code>nix</code>.</p>
<h2 id="docker"><a class="header" href="#docker">Docker</a></h2>
<p>Install <code>docker</code>. It is recommended to follow the instructions from the
<a href="https://docs.docker.com/install/">official site</a>.</p>
<p>Note: currently official site proposes using Docker Desktop for Linux, which is a GUI tool with plenty of quirks. If you
want to only have CLI tool, you need the <code>docker-ce</code> package and you can follow
<a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-ubuntu-20-04">this guide</a> for Ubuntu.</p>
<p>Installing <code>docker</code> via <code>snap</code> or from the default repository can cause troubles.</p>
<p>You need to install both <code>docker</code> and <code>docker compose</code>.</p>
<p><strong>Note:</strong> <code>docker compose</code> is installed automatically with <code>Docker Desktop</code>.</p>
<p><strong>Note:</strong> On linux you may encounter the following error when you’ll try to work with <code>zksync</code>:</p>
<pre><code>ERROR: Couldn't connect to Docker daemon - you might need to run `docker-machine start default`.
</code></pre>
<p>If so, you <strong>do not need</strong> to install <code>docker-machine</code>. Most probably, it means that your user is not added to
the<code>docker</code> group. You can check it as follows:</p>
<pre><code class="language-bash">docker-compose up # Should raise the same error.
sudo docker-compose up # Should start doing things.
</code></pre>
<p>If the first command fails, but the second succeeds, then you need to add your user to the <code>docker</code> group:</p>
<pre><code class="language-bash">sudo usermod -a -G docker your_user_name
</code></pre>
<p>After that, you should logout and login again (user groups are refreshed after the login). The problem should be solved
at this step.</p>
<p>If logging out does not resolve the issue, restarting the computer should.</p>
<h2 id="nodejs--yarn"><a class="header" href="#nodejs--yarn">Node.js &amp; Yarn</a></h2>
<ol>
<li>Install <code>Node</code> (requires version <code>v20</code>). The recommended way is via <a href="https://github.com/nvm-sh/nvm">nvm</a>.</li>
<li>Install <code>yarn</code>. Can be done via <code>npm install -g yarn</code>. Make sure to get version 1.22.19 - you can change the version
by running <code>yarn set version 1.22.19</code>.</li>
</ol>
<h2 id="clang"><a class="header" href="#clang">clang</a></h2>
<p>In order to compile RocksDB, you must have LLVM available. On debian-based linux it can be installed as follows:</p>
<p>On debian-based linux:</p>
<pre><code class="language-bash">sudo apt-get install build-essential pkg-config cmake clang lldb lld
</code></pre>
<p>On macOS:</p>
<p>You need to have an up-to-date <code>Xcode</code>. You can install it directly from <code>App Store</code>. With Xcode command line tools, you
get the Clang compiler installed by default. Thus, having XCode you don’t need to install <code>clang</code>.</p>
<h2 id="openssl"><a class="header" href="#openssl">OpenSSL</a></h2>
<p>Install OpenSSL:</p>
<p>On mac:</p>
<pre><code class="language-bash">brew install openssl
</code></pre>
<p>On debian-based linux:</p>
<pre><code class="language-bash">sudo apt-get install libssl-dev
</code></pre>
<h2 id="rust"><a class="header" href="#rust">Rust</a></h2>
<p>Install <code>Rust</code>’s toolchain version reported in <code>/rust-toolchain.toml</code> (also a later stable version should work).</p>
<p>Instructions can be found on the <a href="https://www.rust-lang.org/tools/install">official site</a>.</p>
<p>Verify the <code>rust</code> installation:</p>
<pre><code class="language-bash">rustc --version
rustc 1.xx.y (xxxxxx 20xx-yy-zz) # Output may vary depending on actual version of rust
</code></pre>
<p>If you are using macOS with ARM processor (e.g. M1/M2), make sure that you use an <code>aarch64</code> toolchain. For example, when
you run <code>rustup show</code>, you should see a similar input:</p>
<pre><code class="language-bash">rustup show
Default host: aarch64-apple-darwin
rustup home:  /Users/user/.rustup

installed toolchains
--------------------

...

active toolchain
----------------

1.67.1-aarch64-apple-darwin (overridden by '/Users/user/workspace/zksync-era/rust-toolchain')
</code></pre>
<p>If you see <code>x86_64</code> mentioned in the output, probably you’re running (or used to run) your IDE/terminal in Rosetta. If
that’s the case, you should probably change the way you run terminal, and/or reinstall your IDE, and then reinstall the
Rust toolchain as well.</p>
<h2 id="postgresql-client-library"><a class="header" href="#postgresql-client-library">PostgreSQL Client Library</a></h2>
<p>For development purposes, you typically only need the PostgreSQL client library, not the full server installation.
Here’s how to install it:</p>
<p>On macOS:</p>
<pre><code class="language-bash">brew install libpq
</code></pre>
<p>On Debian-based Linux:</p>
<pre><code class="language-bash">sudo apt-get install libpq-dev
</code></pre>
<h3 id="cargo-nextest"><a class="header" href="#cargo-nextest">Cargo nextest</a></h3>
<p><a href="https://nexte.st/">cargo-nextest</a> is the next-generation test runner for Rust projects. <code>zkstack dev test rust</code> uses
<code>cargo nextest</code> by default.</p>
<pre><code class="language-bash">cargo install cargo-nextest
</code></pre>
<h3 id="sqlx-cli"><a class="header" href="#sqlx-cli">SQLx CLI</a></h3>
<p>SQLx is a Rust library we use to interact with Postgres, and its CLI is used to manage DB migrations and support several
features of the library.</p>
<pre><code class="language-bash">cargo install --locked sqlx-cli --version 0.8.1
</code></pre>
<h2 id="easier-method-using-nix"><a class="header" href="#easier-method-using-nix">Easier method using <code>nix</code></a></h2>
<p>Nix is a tool that can fetch <em>exactly</em> the right dependencies specified via hashes. The current config is Linux-only but
it is likely that it can be adapted to Mac.</p>
<p>Install <code>nix</code>. Enable the nix command and flakes.</p>
<p>Install docker, rustup and use rust to install SQLx CLI like described above. If you are on NixOS, you also need to
enable nix-ld.</p>
<p>Go to the zksync folder and run <code>nix develop</code>. After it finishes, you are in a shell that has all the dependencies.</p>
<h2 id="foundry-zksync"><a class="header" href="#foundry-zksync">Foundry ZKsync</a></h2>
<p>ZKSync depends on Foundry ZKsync (which is is a specialized fork of Foundry, tailored for ZKsync). Please follow this
<a href="https://foundry-book.zksync.io/getting-started/installation">installation guide</a> to get started with Foundry ZKsync.</p>
<p>Foundry ZKsync can also be used for deploying smart contracts. For commands related to deployment, you can pass flags
for Foundry integration.</p>
<h2 id="non-gpu-setup"><a class="header" href="#non-gpu-setup">Non-GPU setup</a></h2>
<p>Circuit Prover requires a CUDA bindings to run. If you still want to be able to build everything locally on non-CUDA
setup, you’ll need use CUDA stubs.</p>
<p>For a single run, it’s enough to export it on the shell:</p>
<pre><code>export ZKSYNC_USE_CUDA_STUBS=true
</code></pre>
<p>For persistent runs, you can echo it in your ~/.<shell>rc file</p>
<pre><code>echo "export ZKSYNC_USE_CUDA_STUBS=true" &gt;&gt; ~/.&lt;SHELL&gt;rc
</code></pre>
<p>Note that the same can be achieved with RUSTFLAGS (discouraged). The flag is <code>--cfg=no_cuda</code>. You can either set
RUSTFLAGS as env var, or pass it in <code>config.toml</code> (either project level or global). The config would need the following:</p>
<pre><code class="language-toml">[build]
rustflags = ["--cfg=no_cuda"]
</code></pre>
<h2 id="tips"><a class="header" href="#tips">Tips</a></h2>
<h3 id="tip-mold"><a class="header" href="#tip-mold">Tip: <code>mold</code></a></h3>
<p>Optionally, you may want to optimize the build time with the modern linker, <a href="https://github.com/rui314/mold"><code>mold</code></a>.</p>
<p>This linker will speed up the build times, which can be pretty big for Rust binaries.</p>
<p>Follow the instructions in the repo in order to install it and enable for Rust.</p>
<p>If you installed <code>mold</code> to <code>/usr/local/bin/mold</code>, then the quickest way to use it without modifying any files is:</p>
<pre><code class="language-bash">export RUSTFLAGS='-C link-arg=-fuse-ld=/usr/local/bin/mold'
export CARGO_TARGET_X86_64_UNKNOWN_LINUX_GNU_LINKER="clang"
</code></pre>
<h3 id="tip-speeding-up-building-rocksdb"><a class="header" href="#tip-speeding-up-building-rocksdb">Tip: Speeding up building <code>RocksDB</code></a></h3>
<p>By default, each time you compile <code>rocksdb</code> crate, it will compile required C++ sources from scratch. It can be avoided
by using precompiled versions of library, and it will significantly improve your build times.</p>
<p>In order to do so, you can put compiled libraries to some persistent location, and add the following to your shell
configuration file (e.g. <code>.zshrc</code> or <code>.bashrc</code>):</p>
<pre><code>export ROCKSDB_LIB_DIR=&lt;library location&gt;
export SNAPPY_LIB_DIR=&lt;library location&gt;
</code></pre>
<p>Make sure that compiled libraries match the current version of RocksDB. One way to obtain them, is to compile the
project in the usual way once, and then take built libraries from
<code>target/{debug,release}/build/librocksdb-sys-{some random value}/out</code>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../guides/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../guides/development.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../guides/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../guides/development.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>



        <script>
            window.playground_line_numbers = true;
        </script>

        <script>
            window.playground_copyable = true;
        </script>

        <script src="../ace.js"></script>
        <script src="../editor.js"></script>
        <script src="../mode-rust.js"></script>
        <script src="../theme-dawn.js"></script>
        <script src="../theme-tomorrow_night.js"></script>

        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../js/version-box.js"></script>
        <script src="../js/mermaid-init.js"></script>


    </div>
    </body>
</html>
