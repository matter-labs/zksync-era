<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Development - ZKsync Era Documentation</title>


        <!-- Custom HTML head -->
        <script src="https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js"></script>

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../css/version-box.css">
        <link rel="stylesheet" href=".././css/mdbook-admonish.css">

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">ZKsync Era Documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/matter-labs/zksync-era/tree/main/docs" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/matter-labs/zksync-era/tree/main/docs/src/guides/development.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="development-guide"><a class="header" href="#development-guide">Development guide</a></h1>
<p>This document outlines the steps for setting up and working with ZKsync.</p>
<h2 id="prerequisites"><a class="header" href="#prerequisites">Prerequisites</a></h2>
<p>If you haven’t already, install the prerequisites as described in <a href="./setup-dev.html">Install Dependencies</a>.</p>
<h2 id="installing-the-local-zk-stack-cli"><a class="header" href="#installing-the-local-zk-stack-cli">Installing the local ZK Stack CLI</a></h2>
<p>To set up local development, begin by installing
<a href="https://github.com/matter-labs/zksync-era/blob/main/zkstack_cli/README.md">ZK Stack CLI</a>. From the project’s root
directory, run the following commands:</p>
<pre><code class="language-bash">cd ./zkstack_cli/zkstackup
./install --local
</code></pre>
<p>This installs <code>zkstackup</code> in your user binaries directory (e.g., <code>$HOME/.local/bin/</code>) and adds it to your <code>PATH</code>.</p>
<p>After installation, open a new terminal or reload your shell profile. From the project’s root directory, you can now
run:</p>
<pre><code class="language-bash">zkstackup --local
</code></pre>
<p>This command installs <code>zkstack</code> from the current source directory.</p>
<p>You can proceed to verify the installation and start familiarizing with the CLI by running:</p>
<pre><code class="language-bash">zkstack --help
</code></pre>
<div id="admonition-note" class="admonition admonish-note" role="note" aria-labelledby="admonition-note-title">
<div class="admonition-title">
<div id="admonition-note-title">
<p>Note</p>
</div>
<a class="admonition-anchor-link" href="#admonition-note"></a>
</div>
<div>
<p>NOTE: Whenever you want to update you local installation with your changes, just rerun:</p>
<p><code>zkstackup --local</code></p>
<p>You might find convenient to add this alias to your shell profile:</p>
<p><code>alias zkstackup='zkstackup --path /path/to/zksync-era'</code></p>
</div>
</div>
<h2 id="configure-ecosystem"><a class="header" href="#configure-ecosystem">Configure Ecosystem</a></h2>
<p>The project root directory includes configuration files for an ecosystem with a single chain, <code>era</code>. To initialize the
ecosystem, first start the required containers:</p>
<pre><code class="language-bash">zkstack containers
</code></pre>
<p>Next, run:</p>
<pre><code class="language-bash">zkstack ecosystem init
</code></pre>
<p>These commands will guide you through the configuration options for setting up the ecosystem.</p>
<div id="admonition-note-1" class="admonition admonish-note" role="note" aria-labelledby="admonition-note-1-title">
<div class="admonition-title">
<div id="admonition-note-1-title">
<p>Note</p>
</div>
<a class="admonition-anchor-link" href="#admonition-note-1"></a>
</div>
<div>
<p>For local development only. You can also use the development defaults by supplying the <code>--dev</code> flag.</p>
</div>
</div>
<p>Initialization may take some time, but key steps (such as downloading and unpacking keys or setting up containers) only
need to be completed once.</p>
<p>To see more detailed output, you can run commands with the <code>--verbose</code> flag.</p>
<h2 id="cleanup"><a class="header" href="#cleanup">Cleanup</a></h2>
<p>To clean up the local ecosystem (e.g., removing containers and clearing the contract cache), run:</p>
<pre><code class="language-bash">zkstack dev clean all
</code></pre>
<p>You can then reinitialize the ecosystem as described in the <a href="#configure-ecosystem">Configure Ecosystem</a> section.</p>
<pre><code class="language-bash">zkstack containers
zkstack ecosystem init
</code></pre>
<h2 id="committing-changes"><a class="header" href="#committing-changes">Committing changes</a></h2>
<p><code>zksync</code> uses pre-commit and pre-push git hooks for basic code integrity checks. Hooks are set up automatically within
the workspace initialization process. These hooks will not allow to commit the code which does not pass several checks.</p>
<p>Currently the following criteria are checked:</p>
<ul>
<li>Code must be formatted via <code>zkstack dev fmt</code>.</li>
<li>Code must be linted via <code>zkstack dev lint</code>.</li>
</ul>
<h2 id="testing"><a class="header" href="#testing">Testing</a></h2>
<p>ZKstack CLI offers multiple subcommands to run specific integration and unit test:</p>
<pre><code class="language-bash">zkstack dev test --help
</code></pre>
<pre><code class="language-bash">Usage: zkstack dev test [OPTIONS] &lt;COMMAND&gt;

Commands:
  integration   Run integration tests
  fees          Run fees test
  revert        Run revert tests
  recovery      Run recovery tests
  upgrade       Run upgrade tests
  build         Build all test dependencies
  rust          Run unit-tests, accepts optional cargo test flags
  l1-contracts  Run L1 contracts tests
  prover        Run prover tests
  wallet        Print test wallets information
  loadtest      Run loadtest
  help          Print this message or the help of the given subcommand(s)
</code></pre>
<h3 id="running-unit-tests"><a class="header" href="#running-unit-tests">Running unit tests</a></h3>
<p>You can run unit tests for the Rust crates in the project by running:</p>
<pre><code class="language-bash">zkstack dev test rust
</code></pre>
<h3 id="running-integration-tests"><a class="header" href="#running-integration-tests">Running integration tests</a></h3>
<p>Running integration tests is more complex. Some tests require a running server, while others need the system to be in a
specific state. Please refer to our CI scripts
<a href="https://github.com/matter-labs/zksync-era/blob/main/.github/workflows/ci-core-reusable.yml">ci-core-reusable.yml</a> to
have a better understanding of the process.</p>
<p>In simple terms, the integration-test workflow consists of three phases:</p>
<ol>
<li>
<p><strong>Initializing the ecosystem</strong></p>
<pre><code class="language-bash">zkstack dev clean all         # remove any previous state
zkstack containers            # start required Docker containers
zkstack ecosystem init        # set up blockchain and contracts
</code></pre>
</li>
<li>
<p><strong>Starting the server</strong></p>
<pre><code class="language-bash">zkstack server                # spin up the server
</code></pre>
<p>This command starts the server and occupies the current terminal window. Open a new terminal window for any
subsequent commands.</p>
</li>
<li>
<p><strong>Running integration tests</strong></p>
<pre><code class="language-bash">zkstack dev test integration  # run the integration tests
</code></pre>
</li>
</ol>
<blockquote>
<p><em>Note: This is a high-level summary and does not reflect every nuance in <code>ci-core-reusable.yml</code>.</em></p>
</blockquote>
<h3 id="running-upgrade-tests"><a class="header" href="#running-upgrade-tests">Running upgrade tests</a></h3>
<p>Similar to integration tests, the whole setup is complicated and it is recommended to refer to our CI scripts
<a href="https://github.com/matter-labs/zksync-era/blob/main/.github/workflows/ci-core-reusable.yml">ci-core-reusable.yml</a> to
have a better understanding of the process.</p>
<p>In simple terms, the upgrade-test workflow consists of three phases:</p>
<ol>
<li>
<p><strong>Initializing the ecosystem</strong><br />
Same as for integration tests workflow.</p>
</li>
<li>
<p><strong>Starting the server</strong><br />
Same as for integration tests workflow.</p>
</li>
<li>
<p><strong>Running integration tests</strong></p>
<pre><code class="language-bash">ZKSYNC_HOME=&lt;path_to_zksync_era&gt; zkstack dev test upgrade # run the upgrade tests
</code></pre>
</li>
</ol>
<blockquote>
<p><em>Note: This is a high-level summary and does not reflect every nuance in <code>ci-core-reusable.yml</code>.</em></p>
</blockquote>
<h3 id="running-load-tests"><a class="header" href="#running-load-tests">Running load tests</a></h3>
<p>The current load test implementation only supports the legacy bridge. To use it, you need to create a new chain with
legacy bridge support:</p>
<pre><code class="language-bash">zkstack chain create --legacy-bridge
zkstack chain init
</code></pre>
<p>After initializing the chain with a legacy bridge, you can run the load test against it.</p>
<pre><code class="language-bash">zkstack dev test loadtest
</code></pre>
<div id="admonition-warning" class="admonition admonish-warning" role="note" aria-labelledby="admonition-warning-title">
<div class="admonition-title">
<div id="admonition-warning-title">
<p>Warning</p>
</div>
<a class="admonition-anchor-link" href="#admonition-warning"></a>
</div>
<div>
<p>Never use legacy bridges in non-testing environments.</p>
</div>
</div>
<h2 id="contracts"><a class="header" href="#contracts">Contracts</a></h2>
<h3 id="build-contracts"><a class="header" href="#build-contracts">Build contracts</a></h3>
<p>Run:</p>
<pre><code class="language-bash">zkstack dev contracts --help
</code></pre>
<p>to see all the options.</p>
<h3 id="publish-source-code-on-etherscan"><a class="header" href="#publish-source-code-on-etherscan">Publish source code on Etherscan</a></h3>
<h4 id="verifier-options"><a class="header" href="#verifier-options">Verifier Options</a></h4>
<p>Most commands interacting with smart contracts support the same verification options as Foundry’s <code>forge</code> command. Just
double check if the following options are available in the subcommand:</p>
<pre><code class="language-bash">--verifier                  -- Verifier to use
--verifier-api-key          -- Verifier API key
--verifier-url              -- Verifier URL, if using a custom provider
</code></pre>
<h4 id="using-foundry"><a class="header" href="#using-foundry">Using Foundry</a></h4>
<p>You can use <code>foundry</code> to verify the source code of the contracts.</p>
<pre><code class="language-bash">forge verify-contract
</code></pre>
<p>Verifies a smart contract on a chosen verification provider.</p>
<p>You must provide:</p>
<ul>
<li>The contract address</li>
<li>The contract name or the path to the contract.</li>
<li>In case of Etherscan verification, you must also provide:
<ul>
<li>Your Etherscan API key, either by passing it as an argument or setting <code>ETHERSCAN_API_KEY</code></li>
</ul>
</li>
</ul>
<p>For more information check <a href="https://book.getfoundry.sh/reference/forge/forge-verify-contract">Foundry’s documentation</a>.</p>
<h2 id="how-to-generate-the-genesisyaml-file"><a class="header" href="#how-to-generate-the-genesisyaml-file">How to generate the <code>genesis.yaml</code> file</a></h2>
<p>To generate the <a href="https://github.com/matter-labs/zksync-era/blob/main//etc/env/file_based/genesis.yaml"><code>genesis.yaml</code></a>
file checkout to the desired <code>zksync-era</code> branch, <a href="#installing-the-local-zk-stack-cli">build <code>zkstack</code></a> from it,
<a href="#configure-ecosystem">configure ecosystem</a> and run the following command:</p>
<pre><code class="language-shell">zkstack dev generate-genesis
</code></pre>
<p>Which runs the <a href="https://github.com/matter-labs/zksync-era/tree/main/core/bin/genesis_generator"><code>genesis_generator</code></a>
package under the hood and generates the genesis file.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../guides/setup-dev.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../guides/launch.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../guides/setup-dev.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../guides/launch.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>



        <script>
            window.playground_line_numbers = true;
        </script>

        <script>
            window.playground_copyable = true;
        </script>

        <script src="../ace.js"></script>
        <script src="../editor.js"></script>
        <script src="../mode-rust.js"></script>
        <script src="../theme-dawn.js"></script>
        <script src="../theme-tomorrow_night.js"></script>

        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../js/version-box.js"></script>
        <script src="../js/mermaid-init.js"></script>


    </div>
    </body>
</html>
