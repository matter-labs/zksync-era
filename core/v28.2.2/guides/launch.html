<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Launch - ZKsync Era Documentation</title>


        <!-- Custom HTML head -->
        <script src="https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js"></script>

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../css/version-box.css">
        <link rel="stylesheet" href=".././css/mdbook-admonish.css">

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">ZKsync Era Documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/matter-labs/zksync-era/tree/main/docs" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/matter-labs/zksync-era/tree/main/docs/src/guides/launch.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="running-the-application"><a class="header" href="#running-the-application">Running the application</a></h1>
<p>This document covers common scenarios for launching ZKsync applications set locally.</p>
<h2 id="prerequisites"><a class="header" href="#prerequisites">Prerequisites</a></h2>
<p>Prepare dev environment prerequisites: see</p>
<p><a href="./setup-dev.html">Installing dependencies</a></p>
<h2 id="setup-local-dev-environment"><a class="header" href="#setup-local-dev-environment">Setup local dev environment</a></h2>
<p>Run the required containers with:</p>
<pre><code class="language-bash">zkstack containers
</code></pre>
<p>Setup:</p>
<pre><code class="language-bash">zkstack ecosystem init
</code></pre>
<p>To completely reset the dev environment:</p>
<ul>
<li>
<p>Stop services:</p>
<pre><code class="language-bash">zkstack dev clean all
</code></pre>
</li>
<li>
<p>Repeat the setup procedure above</p>
<pre><code class="language-bash">zkstack containers
zkstack ecosystem init
</code></pre>
</li>
</ul>
<h3 id="run-observability-stack"><a class="header" href="#run-observability-stack">Run observability stack</a></h3>
<p>If you want to run <a href="https://github.com/stefanprodan/dockprom/">Dockprom</a> stack (Prometheus, Grafana) alongside other
containers - add <code>--observability</code> parameter during initialisation.</p>
<pre><code class="language-bash">zkstack containers --observability
</code></pre>
<p>or select <code>yes</code> when prompted during the interactive execution of the command.</p>
<p>That will also provision Grafana with
<a href="https://github.com/matter-labs/era-observability/tree/main/dashboards">era-observability</a> dashboards. You can then
access it at <code>http://127.0.0.1:3000/</code> under credentials <code>admin/admin</code>.</p>
<blockquote>
<p>If you don’t see any data displayed on the Grafana dashboards - try setting the timeframe to “Last 30 minutes”. You
will also have to have <code>jq</code> installed on your system.</p>
</blockquote>
<h2 id="ecosystem-configuration"><a class="header" href="#ecosystem-configuration">Ecosystem Configuration</a></h2>
<p>The ecosystem configuration is spread across multiple files and directories:</p>
<ol>
<li>
<p>Root level:</p>
<ul>
<li><code>ZkStack.yaml</code>: Main configuration file for the entire ecosystem.</li>
</ul>
</li>
<li>
<p><code>configs/</code> directory:</p>
<ul>
<li><code>apps/</code>:
<ul>
<li><code>portal_config.json</code>: Configuration for the portal application.</li>
</ul>
</li>
<li><code>contracts.yaml</code>: Defines smart contract settings and addresses.</li>
<li><code>erc20.yaml</code>: Configuration for ERC20 tokens.</li>
<li><code>initial_deployments.yaml</code>: Specifies initial ERC20 token deployments.</li>
<li><code>wallets.yaml</code>: Contains wallet configurations.</li>
</ul>
</li>
<li>
<p><code>chains/&lt;chain_name&gt;/</code> directory:</p>
<ul>
<li><code>artifacts/</code>: Contains build/execution artifacts.</li>
<li><code>configs/</code>: Chain-specific configuration files.
<ul>
<li><code>contracts.yaml</code>: Chain-specific smart contract settings.</li>
<li><code>external_node.yaml</code>: Configuration for external nodes.</li>
<li><code>general.yaml</code>: General chain configuration.</li>
<li><code>genesis.yaml</code>: Genesis configuration for the chain.</li>
<li><code>secrets.yaml</code>: Secrets and private keys for the chain.</li>
<li><code>wallets.yaml</code>: Wallet configurations for the chain.</li>
</ul>
</li>
<li><code>db/main/</code>: Database files for the chain.</li>
<li><code>ZkStack.yaml</code>: Chain-specific ZkStack configuration.</li>
</ul>
</li>
</ol>
<p>These configuration files are automatically generated during the ecosystem initialization (<code>zkstack ecosystem init</code>) and
chain initialization (<code>zkstack chain init</code>) processes. They control various aspects of the ZKsync ecosystem, including:</p>
<ul>
<li>Network settings</li>
<li>Smart contract deployments</li>
<li>Token configurations</li>
<li>Database settings</li>
<li>Application/Service-specific parameters</li>
</ul>
<p>It’s important to note that while these files can be manually edited, any changes may be overwritten if the ecosystem or
chain is reinitialized. Always back up your modifications and exercise caution when making direct changes to these
files.</p>
<p>For specific configuration needs, it’s recommended to use the appropriate <code>zkstack</code> commands or consult the
documentation for safe ways to customize your setup.</p>
<h2 id="build-and-run-server"><a class="header" href="#build-and-run-server">Build and run server</a></h2>
<p>Run server:</p>
<pre><code class="language-bash">zkstack server
</code></pre>
<p>The server’s configuration files can be found in <code>/chains/&lt;chain_name&gt;/configs</code> directory. These files are created when
running <code>zkstack chain init</code> command.</p>
<h3 id="modifying-configuration-files-manually"><a class="header" href="#modifying-configuration-files-manually">Modifying configuration files manually</a></h3>
<p>To manually modify configuration files:</p>
<ol>
<li>Locate the relevant config file in <code>/chains/&lt;chain_name&gt;/configs</code></li>
<li>Open the file in a text editor</li>
<li>Make necessary changes, following the existing format</li>
<li>Save the file</li>
<li>Restart the relevant services for changes to take effect:</li>
</ol>
<pre><code class="language-bash">zkstack server
</code></pre>
<div id="admonition-note" class="admonition admonish-note" role="note" aria-labelledby="admonition-note-title">
<div class="admonition-title">
<div id="admonition-note-title">
<p>Note</p>
</div>
<a class="admonition-anchor-link" href="#admonition-note"></a>
</div>
<div>
<p>Manual changes to configuration files may be overwritten if the ecosystem is reinitialized or the chain is
reinitialized.</p>
</div>
</div>
<div id="admonition-warning" class="admonition admonish-warning" role="note" aria-labelledby="admonition-warning-title">
<div class="admonition-title">
<div id="admonition-warning-title">
<p>Warning</p>
</div>
<a class="admonition-anchor-link" href="#admonition-warning"></a>
</div>
<div>
<p>Some properties, such as ports, may require manual modification across different configuration files to
ensure consistency and avoid conflicts.</p>
</div>
</div>
<h2 id="running-server-using-google-cloud-storage-object-store-instead-of-default-in-memory-store"><a class="header" href="#running-server-using-google-cloud-storage-object-store-instead-of-default-in-memory-store">Running server using Google cloud storage object store instead of default In memory store</a></h2>
<p>Get the <code>service_account.json</code> file containing the GCP credentials from kubernetes secret for relevant
environment(stage2/ testnet2) add that file to the default location <code>~/gcloud/service_account.json</code> or update
<code>object_store.toml</code> with the file location</p>
<pre><code class="language-bash">zkstack prover init --bucket-base-url={url} --credentials-file={path/to/service_account.json}
</code></pre>
<h2 id="running-prover-server"><a class="header" href="#running-prover-server">Running prover server</a></h2>
<p>Running on a machine with GPU</p>
<pre><code class="language-bash">zkstack prover run --component=prover
</code></pre>
<div id="admonition-note-1" class="admonition admonish-note" role="note" aria-labelledby="admonition-note-1-title">
<div class="admonition-title">
<div id="admonition-note-1-title">
<p>Note</p>
</div>
<a class="admonition-anchor-link" href="#admonition-note-1"></a>
</div>
<div>
<p>Running on machine without GPU is currently not supported by <code>zkstack</code>.</p>
</div>
</div>
<h2 id="running-the-verification-key-generator"><a class="header" href="#running-the-verification-key-generator">Running the verification key generator</a></h2>
<pre><code class="language-bash"># ensure that the setup_2^26.key in the current directory, the file can be download from  https://storage.googleapis.com/matterlabs-setup-keys-us/setup-keys/setup_2\^26.key

# To generate all verification keys
cargo run --release --bin zksync_verification_key_generator
</code></pre>
<h2 id="generating-binary-verification-keys-for-existing-json-verification-keys"><a class="header" href="#generating-binary-verification-keys-for-existing-json-verification-keys">Generating binary verification keys for existing json verification keys</a></h2>
<pre><code class="language-bash">cargo run --release --bin zksync_json_to_binary_vk_converter -- -o /path/to/output-binary-vk
</code></pre>
<h2 id="generating-commitment-for-existing-verification-keys"><a class="header" href="#generating-commitment-for-existing-verification-keys">Generating commitment for existing verification keys</a></h2>
<pre><code class="language-bash">cargo run --release --bin zksync_commitment_generator
</code></pre>
<h2 id="running-the-contract-verifier"><a class="header" href="#running-the-contract-verifier">Running the contract verifier</a></h2>
<pre><code class="language-bash">zkstack contract-verifier run
</code></pre>
<h2 id="troubleshooting"><a class="header" href="#troubleshooting">Troubleshooting</a></h2>
<h3 id="connection-refused"><a class="header" href="#connection-refused">Connection Refused</a></h3>
<h4 id="problem"><a class="header" href="#problem">Problem</a></h4>
<pre><code class="language-bash">error sending request for url (http://127.0.0.1:8545/): error trying to connect: tcp connect error: Connection refused (os error 61)
</code></pre>
<h4 id="description"><a class="header" href="#description">Description</a></h4>
<p>It appears that no containers are currently running, which is likely the reason you’re encountering this error.</p>
<h4 id="solution"><a class="header" href="#solution">Solution</a></h4>
<p>Ensure that the necessary containers have been started and are functioning correctly to resolve the issue.</p>
<pre><code class="language-bash">zkstack containers
</code></pre>
<h3 id="zkstack-dev-lint---check--t-contracts-fails"><a class="header" href="#zkstack-dev-lint---check--t-contracts-fails"><code>zkstack dev lint --check -t contracts</code> fails</a></h3>
<h4 id="problem-1"><a class="header" href="#problem-1">Problem</a></h4>
<pre><code>zkstack dev lint --check -t contracts                                                                                                                                                                                                                                 138ms  13:13:01

┌   ZK Stack CLI
│
●  Running linters for targets: [".contracts"]
│
◒  Running contracts linter..                                                                                                                                                                                                                                                                                    │
■  Command failed to run
│
■    Status:
│      exit status: 2
│    Stdout:
│      yarn run v1.22.22
│      $ yarn lint:md &amp;&amp; yarn lint:sol &amp;&amp; yarn lint:ts &amp;&amp; yarn prettier:check
│      $ markdownlint "**/*.md"
│      $ solhint "**/*.sol"
│      A new version of Solhint is available: 5.0.5
│      Please consider updating your Solhint package.
│
│      system-contracts/contracts/ContractDeployer.sol
│      171:27 warning Avoid to use tx.origin avoid-tx-origin
│
│      ✖ 1 problem (0 errors, 1 warning)
│
│      $ eslint .
│      info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.
│      info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.
│
│
│    Stderr:
│
│      Oops! Something went wrong! :(
│
│      ESLint: 8.57.0
│
│      EslintPluginImportResolveError: typescript with invalid interface loaded as resolver
│      Occurred while linting /home/evl/code/zksync-era/contracts/system-contracts/scripts/utils.ts:19
│      Rule: "import/default"
│      at requireResolver (/home/evl/code/zksync-era/node_modules/eslint-module-utils/resolve.js:204:17)
│      at fullResolve (/home/evl/code/zksync-era/node_modules/eslint-module-utils/resolve.js:141:22)
│      at Function.relative (/home/evl/code/zksync-era/node_modules/eslint-module-utils/resolve.js:158:10)
│      at remotePath (/home/evl/code/zksync-era/contracts/node_modules/eslint-plugin-import/lib/ExportMap.js:811:381)
│      at captureDependency (/home/evl/code/zksync-era/contracts/node_modules/eslint-plugin-import/lib/ExportMap.js:817:463)
│      at captureDependencyWithSpecifiers
│      (/home/evl/code/zksync-era/contracts/node_modules/eslint-plugin-import/lib/ExportMap.js:817:144)
│      at /home/evl/code/zksync-era/contracts/node_modules/eslint-plugin-import/lib/ExportMap.js:822:42
│      at Array.forEach (&lt;anonymous&gt;)
│      at ExportMap.parse (/home/evl/code/zksync-era/contracts/node_modules/eslint-plugin-import/lib/ExportMap.js:821:427)
│      at ExportMap.for (/home/evl/code/zksync-era/contracts/node_modules/eslint-plugin-import/lib/ExportMap.js:807:201)
│      error Command failed with exit code 2.
│      error Command failed with exit code 2.
│
│
■  Command failed to run: yarn --cwd contracts lint:check
│
│  Oops! Something went wrong! :(
│
│  ESLint: 8.57.0
│
│  EslintPluginImportResolveError: typescript with invalid interface loaded as resolver
│  Occurred while linting /home/evl/code/zksync-era/contracts/system-contracts/scripts/utils.ts:19
│  Rule: "import/default"
│      at requireResolver (/home/evl/code/zksync-era/node_modules/eslint-module-utils/resolve.js:204:17)
│      at fullResolve (/home/evl/code/zksync-era/node_modules/eslint-module-utils/resolve.js:141:22)
│      at Function.relative (/home/evl/code/zksync-era/node_modules/eslint-module-utils/resolve.js:158:10)
│      at remotePath (/home/evl/code/zksync-era/contracts/node_modules/eslint-plugin-import/lib/ExportMap.js:811:381)
│      at captureDependency (/home/evl/code/zksync-era/contracts/node_modules/eslint-plugin-import/lib/ExportMap.js:817:463)
│      at captureDependencyWithSpecifiers (/home/evl/code/zksync-era/contracts/node_modules/eslint-plugin-import/lib/ExportMap.js:817:144)
│      at /home/evl/code/zksync-era/contracts/node_modules/eslint-plugin-import/lib/ExportMap.js:822:42
│      at Array.forEach (&lt;anonymous&gt;)
│      at ExportMap.parse (/home/evl/code/zksync-era/contracts/node_modules/eslint-plugin-import/lib/ExportMap.js:821:427)
│      at ExportMap.for (/home/evl/code/zksync-era/contracts/node_modules/eslint-plugin-import/lib/ExportMap.js:807:201)
│  error Command failed with exit code 2.
│  error Command failed with exit code 2.
│
│
▲    0: Command failed to run: yarn --cwd contracts lint:check
│
└  Failed to run command
</code></pre>
<h4 id="description-1"><a class="header" href="#description-1">Description</a></h4>
<p><code>npm</code> setup is nested within our codebase. Contracts has it &amp; so does the core codebase. The 2 can be incompatible,
therefore running <code>yarn install</code> in core ends up with a set of dependencies, with <code>yarn install</code> in contracts having a
different set of dependencies.</p>
<h4 id="solution-1"><a class="header" href="#solution-1">Solution</a></h4>
<pre><code>cd contracts &amp;&amp; yarn install
</code></pre>
<div id="admonition-note-2" class="admonition admonish-note" role="note" aria-labelledby="admonition-note-2-title">
<div class="admonition-title">
<div id="admonition-note-2-title">
<p>Note</p>
</div>
<a class="admonition-anchor-link" href="#admonition-note-2"></a>
</div>
<div>
<p>This may cause integration tests to fail in core. If so, run <code>yarn install</code> inside core repo.</p>
</div>
</div>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../guides/development.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../guides/architecture.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../guides/development.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../guides/architecture.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>



        <script>
            window.playground_line_numbers = true;
        </script>

        <script>
            window.playground_copyable = true;
        </script>

        <script src="../ace.js"></script>
        <script src="../editor.js"></script>
        <script src="../mode-rust.js"></script>
        <script src="../theme-dawn.js"></script>
        <script src="../theme-tomorrow_night.js"></script>

        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../js/version-box.js"></script>
        <script src="../js/mermaid-init.js"></script>


    </div>
    </body>
</html>
